{% extends 'base.html' %}
{% block title %}Ranking - Torneio{% endblock %}

{% block content %}
<div class="fade-in">

<h1 class="text-center app-title mb-4">
  <i class="bi bi-trophy-fill me-2" style="color: var(--color-accent);"></i>
  Ranking
</h1>

{% set tem_resultados = namespace(value=false) %}
{% if ranking.masculino %}
  {% for jogador in ranking.masculino %}
    {% if jogador.vitorias > 0 or jogador.derrotas > 0 %}
      {% set tem_resultados.value = true %}
    {% endif %}
  {% endfor %}
{% endif %}

<div class="glass-card text-center mb-4 slide-in">
  <p class="mb-2">
    <i class="bi bi-clock-history me-2" style="color: var(--color-primary);"></i>
    <small class="text-muted">√öltima atualiza√ß√£o: {{ ranking.ultima_atualizacao[:19] if ranking.ultima_atualizacao else 'N/A' }}</small>
  </p>
  {% if not tem_resultados.value %}
    <p class="mt-3 mb-0" style="font-size: 1.1rem; color: var(--color-accent);">
      <i class="bi bi-list-check me-2"></i>
      <strong>Lista de Inscritos</strong> - Aguardando in√≠cio do torneio
    </p>
  {% else %}
    <p class="mt-2 mb-0" style="font-size: 1.1rem; color: var(--color-accent);">
      <i class="bi bi-award-fill me-2"></i>
      <strong>Premia√ß√£o:</strong> Top 3 de cada categoria
    </p>
    <p class="mt-2 mb-0 text-muted">
      <i class="bi bi-info-circle me-2"></i>
      <strong>Crit√©rios:</strong> 1¬∫ Vit√≥rias | 2¬∫ Saldo de Games | 3¬∫ Games Feitos
    </p>
  {% endif %}
</div>

<!-- Filtro de Categoria -->
<div class="glass-card mb-4 slide-in" style="animation-delay: 0.05s;">
  <h3 class="text-center mb-3" style="color: var(--color-text); font-size: 1.3rem;">
    <i class="bi bi-funnel-fill me-2" style="color: var(--color-primary);"></i>
    Filtrar por Categoria
  </h3>
  <div class="row justify-content-center">
    <div class="col-md-6">
      <select id="filtroCategoria" class="form-select form-select-lg">
        <option value="todos">üë• Todos (Masculino e Feminino)</option>
        <option value="masculino">üë® Apenas Masculino</option>
        <option value="feminino">üë© Apenas Feminino</option>
      </select>
    </div>
  </div>
  <p class="text-center text-muted mt-2 mb-0">
    <small>
      <i class="bi bi-info-circle me-1"></i>
      Escolha uma categoria para visualizar o ranking e p√≥dio
    </small>
  </p>
</div>

<!-- P√≥dio de Destaque (apenas se houver resultados) -->
{% if tem_resultados.value and ranking.masculino and ranking.masculino|length >= 3 %}
<div class="glass-card mb-4 slide-in podio-container" style="animation-delay: 0.05s; background: linear-gradient(135deg, rgba(255, 215, 0, 0.1), rgba(212, 175, 55, 0.05));">
  <h3 class="text-center mb-4" style="color: #FFD700; font-size: 1.4rem;">
    <i class="bi bi-award-fill me-2"></i>
    üèÜ P√ìDIO PREMIADO üèÜ
  </h3>
  
  <div class="row text-center">
    <!-- 2¬∫ Lugar -->
    <div class="col-md-4 mb-3">
      <div class="p-3" style="background: linear-gradient(135deg, rgba(192, 192, 192, 0.2), rgba(169, 169, 169, 0.1)); border-radius: 12px; border: 2px solid #C0C0C0;">
        <i class="bi bi-trophy-fill mb-2" style="color: #C0C0C0; font-size: 2rem;"></i>
        <h4 style="color: #C0C0C0; font-size: 1.3rem; margin-bottom: 8px;">2¬∫ LUGAR</h4>
        {% if ranking.masculino|length >= 2 %}
          <p class="mb-1 podio-masculino" style="font-size: 1.1rem; font-weight: 600;">
            <i class="bi bi-person me-1"></i> {{ ranking.masculino[1].nome }}
          </p>
          <small class="text-muted podio-masculino">Masculino - {{ ranking.masculino[1].vitorias }}V</small>
        {% endif %}
        <hr class="podio-separator" style="border-color: rgba(192, 192, 192, 0.3); margin: 10px 0;">
        {% if ranking.feminino|length >= 2 %}
          <p class="mb-1 mt-2 podio-feminino" style="font-size: 1.1rem; font-weight: 600;">
            <i class="bi bi-person me-1"></i> {{ ranking.feminino[1].nome }}
          </p>
          <small class="text-muted podio-feminino">Feminino - {{ ranking.feminino[1].vitorias }}V</small>
        {% endif %}
      </div>
    </div>
    
    <!-- 1¬∫ Lugar -->
    <div class="col-md-4 mb-3">
      <div class="p-3" style="background: linear-gradient(135deg, rgba(255, 215, 0, 0.3), rgba(212, 175, 55, 0.15)); border-radius: 12px; border: 3px solid #FFD700; box-shadow: 0 8px 24px rgba(255, 215, 0, 0.4); transform: translateY(-10px);">
        <i class="bi bi-trophy-fill mb-2" style="color: #FFD700; font-size: 3rem;"></i>
        <h4 style="color: #FFD700; font-size: 1.5rem; margin-bottom: 8px;">ü•á CAMPE√ÉO</h4>
        {% if ranking.masculino|length >= 1 %}
          <p class="mb-1 podio-masculino" style="font-size: 1.2rem; font-weight: 700;">
            <i class="bi bi-person me-1"></i> {{ ranking.masculino[0].nome }}
            <i class="bi bi-star-fill ms-1" style="font-size: 0.9rem;"></i>
          </p>
          <small class="text-muted podio-masculino">Masculino - {{ ranking.masculino[0].vitorias }}V</small>
        {% endif %}
        <hr class="podio-separator" style="border-color: rgba(255, 215, 0, 0.4); margin: 10px 0;">
        {% if ranking.feminino|length >= 1 %}
          <p class="mb-1 mt-2 podio-feminino" style="font-size: 1.2rem; font-weight: 700;">
            <i class="bi bi-person me-1"></i> {{ ranking.feminino[0].nome }}
            <i class="bi bi-star-fill ms-1" style="font-size: 0.9rem;"></i>
          </p>
          <small class="text-muted podio-feminino">Feminino - {{ ranking.feminino[0].vitorias }}V</small>
        {% endif %}
      </div>
    </div>
    
    <!-- 3¬∫ Lugar -->
    <div class="col-md-4 mb-3">
      <div class="p-3" style="background: linear-gradient(135deg, rgba(205, 127, 50, 0.2), rgba(184, 115, 51, 0.1)); border-radius: 12px; border: 2px solid #CD7F32;">
        <i class="bi bi-trophy-fill mb-2" style="color: #CD7F32; font-size: 2rem;"></i>
        <h4 style="color: #CD7F32; font-size: 1.3rem; margin-bottom: 8px;">3¬∫ LUGAR</h4>
        {% if ranking.masculino|length >= 3 %}
          <p class="mb-1 podio-masculino" style="font-size: 1.1rem; font-weight: 600;">
            <i class="bi bi-person me-1"></i> {{ ranking.masculino[2].nome }}
          </p>
          <small class="text-muted podio-masculino">Masculino - {{ ranking.masculino[2].vitorias }}V</small>
        {% endif %}
        <hr class="podio-separator" style="border-color: rgba(205, 127, 50, 0.3); margin: 10px 0;">
        {% if ranking.feminino|length >= 3 %}
          <p class="mb-1 mt-2 podio-feminino" style="font-size: 1.1rem; font-weight: 600;">
            <i class="bi bi-person me-1"></i> {{ ranking.feminino[2].nome }}
          </p>
          <small class="text-muted podio-feminino">Feminino - {{ ranking.feminino[2].vitorias }}V</small>
        {% endif %}
      </div>
    </div>
  </div>
</div>
{% endif %}

<!-- MASCULINO -->
<div class="glass-card mb-4 slide-in ranking-masculino" style="animation-delay: 0.1s;">
  <h2 class="text-center mb-4" style="color: var(--color-primary); font-size: 1.6rem;">
    <i class="bi bi-person-fill me-2"></i>
    RANKING MASCULINO
  </h2>
  
  {% if ranking.masculino and ranking.masculino|length > 0 %}
    <div class="table-responsive">
      <table class="ranking-table">
        <thead>
          <tr>
            <th>#</th>
            <th style="text-align: left;">Jogador</th>
            <th><i class="bi bi-trophy"></i> V</th>
            <th><i class="bi bi-x-circle"></i> D</th>
            <th>%</th>
            <th>Saldo</th>
            <th>GF</th>
            <th>GS</th>
          </tr>
        </thead>
        <tbody>
          {% for jogador in ranking.masculino %}
            <tr {% if tem_resultados.value %}{% if loop.index == 1 %}class="position-1"{% elif loop.index == 2 %}class="position-2"{% elif loop.index == 3 %}class="position-3"{% endif %}{% endif %}>
              <td class="ranking-position">
                {% if tem_resultados.value %}
                  {% if loop.index == 1 %}
                    <i class="bi bi-trophy-fill" style="color: #FFD700; font-size: 1.5rem;"></i>
                  {% elif loop.index == 2 %}
                    <i class="bi bi-trophy-fill" style="color: #C0C0C0; font-size: 1.4rem;"></i>
                  {% elif loop.index == 3 %}
                    <i class="bi bi-trophy-fill" style="color: #CD7F32; font-size: 1.3rem;"></i>
                  {% else %}{{ loop.index }}
                  {% endif %}
                {% else %}
                  {{ loop.index }}
                {% endif %}
              </td>
              <td style="text-align: left; font-weight: {% if loop.index <= 3 and tem_resultados.value %}700{% else %}600{% endif %}; font-size: {% if loop.index <= 3 and tem_resultados.value %}1.1rem{% else %}1rem{% endif %};">
                {{ jogador.nome }}
                {% if tem_resultados.value and loop.index == 1 %}
                  <i class="bi bi-star-fill ms-2" style="color: #FFD700; font-size: 0.9rem;"></i>
                {% endif %}
              </td>
              <td style="color: var(--color-success); font-weight: 600;">{{ jogador.vitorias }}</td>
              <td style="color: var(--color-danger);">{{ jogador.derrotas }}</td>
              <td>{{ jogador.percentual_vitorias }}%</td>
              <td style="font-weight: 600; {% if jogador.saldo_games > 0 %}color: var(--color-success);{% elif jogador.saldo_games < 0 %}color: var(--color-danger);{% endif %}">
                {{ '+' if jogador.saldo_games > 0 else '' }}{{ jogador.saldo_games }}
              </td>
              <td>{{ jogador.games_feitos }}</td>
              <td>{{ jogador.games_sofridos }}</td>
            </tr>
          {% endfor %}
        </tbody>
      </table>
    </div>
  {% else %}
    <p class="text-center text-muted">Nenhum resultado registrado ainda.</p>
  {% endif %}
</div>

<!-- FEMININO -->
<div class="glass-card mb-4 slide-in ranking-feminino" style="animation-delay: 0.2s;">
  <h2 class="text-center mb-4" style="color: var(--color-accent); font-size: 1.6rem;">
    <i class="bi bi-person-fill me-2"></i>
    RANKING FEMININO
  </h2>
  
  {% if ranking.feminino and ranking.feminino|length > 0 %}
    <div class="table-responsive">
      <table class="ranking-table">
        <thead>
          <tr>
            <th>#</th>
            <th style="text-align: left;">Jogadora</th>
            <th><i class="bi bi-trophy"></i> V</th>
            <th><i class="bi bi-x-circle"></i> D</th>
            <th>%</th>
            <th>Saldo</th>
            <th>GF</th>
            <th>GS</th>
          </tr>
        </thead>
        <tbody>
          {% for jogadora in ranking.feminino %}
            <tr {% if tem_resultados.value %}{% if loop.index == 1 %}class="position-1"{% elif loop.index == 2 %}class="position-2"{% elif loop.index == 3 %}class="position-3"{% endif %}{% endif %}>
              <td class="ranking-position">
                {% if tem_resultados.value %}
                  {% if loop.index == 1 %}
                    <i class="bi bi-trophy-fill" style="color: #FFD700; font-size: 1.5rem;"></i>
                  {% elif loop.index == 2 %}
                    <i class="bi bi-trophy-fill" style="color: #C0C0C0; font-size: 1.4rem;"></i>
                  {% elif loop.index == 3 %}
                    <i class="bi bi-trophy-fill" style="color: #CD7F32; font-size: 1.3rem;"></i>
                  {% else %}{{ loop.index }}
                  {% endif %}
                {% else %}
                  {{ loop.index }}
                {% endif %}
              </td>
              <td style="text-align: left; font-weight: {% if loop.index <= 3 and tem_resultados.value %}700{% else %}600{% endif %}; font-size: {% if loop.index <= 3 and tem_resultados.value %}1.1rem{% else %}1rem{% endif %};">
                {{ jogadora.nome }}
                {% if tem_resultados.value and loop.index == 1 %}
                  <i class="bi bi-star-fill ms-2" style="color: #FFD700; font-size: 0.9rem;"></i>
                {% endif %}
              </td>
              <td style="color: var(--color-success); font-weight: 600;">{{ jogadora.vitorias }}</td>
              <td style="color: var(--color-danger);">{{ jogadora.derrotas }}</td>
              <td>{{ jogadora.percentual_vitorias }}%</td>
              <td style="font-weight: 600; {% if jogadora.saldo_games > 0 %}color: var(--color-success);{% elif jogadora.saldo_games < 0 %}color: var(--color-danger);{% endif %}">
                {{ '+' if jogadora.saldo_games > 0 else '' }}{{ jogadora.saldo_games }}
              </td>
              <td>{{ jogadora.games_feitos }}</td>
              <td>{{ jogadora.games_sofridos }}</td>
            </tr>
          {% endfor %}
        </tbody>
      </table>
    </div>
  {% else %}
    <p class="text-center text-muted">Nenhum resultado registrado ainda.</p>
  {% endif %}
</div>

<!-- Legenda -->
<div class="glass-card text-center mb-4 slide-in" style="animation-delay: 0.3s;">
  <p class="mb-1"><strong>Legenda:</strong></p>
  <p class="text-muted small mb-0">
    V = Vit√≥rias | D = Derrotas | % = Percentual de Vit√≥rias | 
    Saldo = Games Feitos - Games Sofridos | GF = Games Feitos | GS = Games Sofridos
  </p>
</div>

<!-- Bot√µes -->
<div class="text-center mb-5">
  <a href="{{ url_for('rota_ver_rodadas') }}" class="btn-primary-custom me-2">
    <i class="bi bi-calendar-event me-2"></i>
    Ver Rodadas
  </a>
  <a href="{{ url_for('index') }}" class="btn-primary-custom">
    <i class="bi bi-house-fill me-2"></i>
    Voltar para In√≠cio
  </a>
</div>

<div style="height: 70px;"></div>

</div>
{% endblock %}

{% block scripts %}
<script>
// Filtro de categoria
document.addEventListener('DOMContentLoaded', function() {
  const filtroCategoria = document.getElementById('filtroCategoria');
  
  if (filtroCategoria) {
    filtroCategoria.addEventListener('change', function() {
      const categoria = this.value;
      
      const rankingMasculino = document.querySelector('.ranking-masculino');
      const rankingFeminino = document.querySelector('.ranking-feminino');
      const podioMasculino = document.querySelectorAll('.podio-masculino');
      const podioFeminino = document.querySelectorAll('.podio-feminino');
      const podioSeparators = document.querySelectorAll('.podio-separator');
      
      if (categoria === 'todos') {
        // Mostrar tudo
        if (rankingMasculino) rankingMasculino.style.display = '';
        if (rankingFeminino) rankingFeminino.style.display = '';
        podioMasculino.forEach(el => el.style.display = '');
        podioFeminino.forEach(el => el.style.display = '');
        podioSeparators.forEach(el => el.style.display = '');
        
      } else if (categoria === 'masculino') {
        // Mostrar apenas masculino
        if (rankingMasculino) rankingMasculino.style.display = '';
        if (rankingFeminino) rankingFeminino.style.display = 'none';
        podioMasculino.forEach(el => el.style.display = '');
        podioFeminino.forEach(el => el.style.display = 'none');
        podioSeparators.forEach(el => el.style.display = 'none');
        
      } else if (categoria === 'feminino') {
        // Mostrar apenas feminino
        if (rankingMasculino) rankingMasculino.style.display = 'none';
        if (rankingFeminino) rankingFeminino.style.display = '';
        podioMasculino.forEach(el => el.style.display = 'none');
        podioFeminino.forEach(el => el.style.display = '');
        podioSeparators.forEach(el => el.style.display = 'none');
      }
    });
  }
});

// Auto-atualizar a cada 30 segundos
setInterval(() => {
  fetch('/ranking')
    .then(res => res.text())
    .then(html => {
      console.log('Ranking verificado');
    })
    .catch(err => console.error('Erro ao atualizar:', err));
}, 30000); // 30 segundos
</script>
{% endblock %}
